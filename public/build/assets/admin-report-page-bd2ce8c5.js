import{a as q,k as U,b as W,j as t,c as p,az as Q,T as x,r as c,am as S,aV as Z,cN as J,bM as X,cm as z,aL as Y,cb as b,w as ee,u as te,cO as se,m as v,cP as I,g as ae,v as M,f as ne,D as re,p as ie,q as oe,B,an as le,A as ce,n as R,z as A,E as me,d as $,aU as de,G as ue}from"./main-4e2f9053.js";import{T as xe,a as ge,b as fe}from"./TrendingUp-4a71f7a5.js";import{R as he,a4 as w,a5 as pe,a6 as je,a7 as F,a8 as be,a9 as ve,aa as we}from"./UnfoldMore-2feaf195.js";import{t as P,F as ye}from"./admin-routes-6a23aec5.js";import"./Edit-f6e2a559.js";import"./use-resume-subscription-52a0ee62.js";const H="admin/reports";function Ne(e={}){return q({queryKey:[H,e],queryFn:()=>De(e),placeholderData:U})}function De({types:e,dateRange:a}){const s={};return e&&(s.types=e.join(",")),a&&(s.startDate=a.start.toAbsoluteString(),s.endDate=a.end.toAbsoluteString(),s.timezone=a.start.timeZone),W.get(H,{params:s}).then(n=>n.data)}function G(e){const{title:a,description:s,children:n,className:r,contentIsFlex:i=!0,contentClassName:l,contentRef:o,minHeight:d="min-h-440"}=e;return t.jsxs("div",{className:p("rounded-panel flex h-full flex-auto flex-col border bg",d,r),children:[t.jsxs("div",{className:"flex flex-shrink-0 items-center justify-between p-14 text-xs",children:[t.jsx("div",{className:"text-sm font-semibold",children:a}),s&&t.jsx("div",{className:"text-muted",children:s})]}),t.jsx("div",{ref:o,className:p("relative p-14",i&&"flex flex-auto items-center justify-center",l),children:n})]})}function y(){return t.jsxs("div",{className:"flex items-center gap-10 text-sm absolute mx-auto",children:[t.jsx(Q,{isIndeterminate:!0,size:"sm"}),t.jsx(x,{message:"Chart loading"})]})}const Ce=c.lazy(()=>S(()=>import("./lazy-chart-7f3c4255.js"),["./lazy-chart-7f3c4255.js","./main-4e2f9053.js","./main-c785ef06.css"],import.meta.url));function N(e){const{title:a,description:s,className:n,contentRef:r,isLoading:i}=e;return t.jsx(G,{title:a,description:s,className:n,contentRef:r,children:t.jsxs(c.Suspense,{fallback:t.jsx(y,{}),children:[t.jsx(Ce,{...e}),i&&t.jsx(y,{})]})})}function D(e,{localeCode:a="en",shareFirstDatasetLabels:s=!0}){if(!e)return{datasets:[]};const n=[];return{...e,datasets:e.datasets.map((r,i)=>{const l=r.data.map((o,d)=>{let m;return i===0||!s?(m=Te(o,e.granularity,a),n[d]=m):m=n[d],{...m,value:o.value}});return{...r,data:l}})}}function Te(e,a,s){return e.label?{label:e.label}:e.date?ke(e,a,s):{label:""}}function ke({date:e,endDate:a},s="day",n){const r=z(e).toDate(),i=a?z(a).toDate():null;switch(s){case"minute":return{label:u(n,{second:"2-digit"}).format(r),tooltipTitle:u(n,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(r)};case"hour":return{label:u(n,{hour:"numeric",minute:"numeric"}).format(r),tooltipTitle:u(n,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(r)};case"day":return{label:u(n,{day:"2-digit",weekday:"short"}).format(r),tooltipTitle:u(n,{day:"2-digit",weekday:"short",month:"short"}).format(r)};case"week":return{label:u(n,{month:"short",day:"2-digit"}).format(r),tooltipTitle:u(n,{day:"2-digit",month:"long",year:"numeric"}).formatRange(r,i)};case"month":return{label:u(n,{month:"short",year:"numeric"}).format(r),tooltipTitle:u(n,{month:"long",year:"numeric"}).format(r)};case"year":return{label:u(n,{year:"numeric"}).format(r),tooltipTitle:u(n,{year:"numeric"}).format(r)}}}const u=Z((e,a)=>new J(e,a),{equals:(e,a)=>X(e,a),callTimeout:void 0}),V=Y().themes.all[0].values["--be-primary"],g=[[`rgb(${V.replaceAll(" ",",")})`,`rgba(${V.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],ze={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function Ie({data:e,className:a,...s}){const{localeCode:n}=b(),r=c.useMemo(()=>{const i=D(e,{localeCode:n});return i.datasets=i.datasets.map((l,o)=>({...l,backgroundColor:g[o][1],borderColor:g[o][0],pointBackgroundColor:g[o][0]})),i},[e,n]);return t.jsx(N,{...s,className:p(a,"min-w-500"),data:r,type:"line",options:ze})}const Re={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function Ae({data:e,className:a,...s}){const{localeCode:n}=b(),r=c.useMemo(()=>{var l;const i=D(e,{localeCode:n});return i.labels=(l=i.datasets[0])==null?void 0:l.data.map(o=>o.label),i.datasets=i.datasets.map((o,d)=>({...o,backgroundColor:g.map(m=>m[1]),borderColor:g.map(m=>m[0]),borderWidth:2})),i},[e,n]);return t.jsx(N,{type:"polarArea",data:r,options:Re,className:p(a,"min-w-500"),...s})}function Fe({data:e,direction:a="vertical",individualBarColors:s=!1,className:n,...r}){const{localeCode:i}=b(),l=c.useMemo(()=>{const m=D(e,{localeCode:i});return m.datasets=m.datasets.map((h,j)=>({...h,backgroundColor:s?g.map(f=>f[1]):g[j][1],borderColor:s?g.map(f=>f[0]):g[j][0],borderWidth:2})),m},[e,i,s]),o=a==="horizontal",d=c.useMemo(()=>({indexAxis:o?"y":"x",parsing:{xAxisKey:o?"value":"label",yAxisKey:o?"label":"value"}}),[o]);return t.jsx(N,{type:"bar",className:p(n,"min-w-500"),data:l,options:d,...r})}const L="https://www.gstatic.com/charts/loader.js";function Pe({placeholderRef:e,data:a,country:s,onCountrySelected:n}){const{trans:r}=ee(),{analytics:i}=te(),l=i==null?void 0:i.gchart_api_key,{selectedTheme:o}=se(),d=c.useRef(),m=!!n&&!s,h=c.useCallback(()=>{var C,T;if(typeof google>"u")return;const f=a.map(k=>[k.label,k.value]);f.unshift([r(s?v("City"):v("Country")),r(v("Clicks"))]);const K=`${P(o.values["--be-paper"])}`,O={colorAxis:{colors:[`${P(o.values["--be-primary"])}`]},backgroundColor:K,region:s?s.toUpperCase():void 0,resolution:s?"provinces":"countries",displayMode:s?"markers":"regions",enableRegionInteractivity:m};!d.current&&e.current&&((C=google==null?void 0:google.visualization)!=null&&C.GeoChart)&&(d.current=new google.visualization.GeoChart(e.current)),(T=d.current)==null||T.draw(google.visualization.arrayToDataTable(f),O)},[o,a,e,r,s,m]),j=c.useCallback(async()=>{I.isLoadingOrLoaded(L)||(await I.loadAsset(L,{type:"js",id:"google-charts-js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:l}),h())},[l,h]);return c.useEffect(()=>(d.current&&n&&google.visualization.events.addListener(d.current,"regionClick",f=>n==null?void 0:n(f.region)),()=>{d.current&&google.visualization.events.removeAllListeners(d.current)}),[n,d.current]),c.useEffect(()=>{j()},[j]),c.useEffect(()=>{h()},[o,h,a]),{drawGoogleChart:h}}const Ve=ae(t.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger");function Le({title:e,body:a,dialogSize:s="sm",className:n}){return t.jsxs(M,{type:"popover",triggerOnHover:!0,children:[t.jsx(ne,{className:p("text-muted opacity-70",n),size:"xs",children:t.jsx(Ve,{viewBox:"0 0 16 16"})}),t.jsxs(re,{size:s,children:[e&&t.jsx(ie,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:e}),t.jsx(oe,{children:a})]})]})}const Ee=c.memo(({code:e})=>{const{localeCode:a}=b(),s=new Intl.DisplayNames([a],{type:"region"});let n;try{n=s.of(e.toUpperCase())}catch{}return t.jsx(c.Fragment,{children:n})});function Me({data:e,isLoading:a,onCountrySelected:s,country:n,...r}){const i=c.useRef(null),l=!!s,o=e==null?void 0:e.datasets[0].data,d=c.useMemo(()=>o||[],[o]);return Pe({placeholderRef:i,data:d,country:n,onCountrySelected:s}),t.jsxs(G,{...r,className:"min-w-500",title:t.jsxs("div",{className:"flex items-center",children:[t.jsx(x,{message:"Top Locations"}),n?t.jsxs("span",{className:"pl-4",children:["(",t.jsx(Ee,{code:n}),")"]}):null,l&&t.jsx(Be,{})]}),contentIsFlex:a,children:[a&&t.jsx(y,{}),t.jsxs("div",{className:"flex gap-24",children:[t.jsx("div",{ref:i,className:"flex-auto w-[480px] min-h-[340px]"}),t.jsxs("div",{className:"w-[170px]",children:[t.jsx("div",{className:"text-sm max-h-[340px] w-full flex-initial overflow-y-auto",children:d.map(m=>t.jsxs("div",{className:p("flex items-center gap-4 mb-4",l&&"cursor-pointer hover:underline"),role:l?"button":void 0,onClick:()=>{s==null||s(m.code)},children:[t.jsx("div",{className:"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis",children:m.label}),t.jsxs("div",{children:["(",m.percentage,")%"]})]},m.label))}),n&&t.jsx(B,{variant:"outline",size:"xs",className:"mt-14",startIcon:t.jsx(he,{}),onClick:()=>{s==null||s(void 0)},children:t.jsx(x,{message:"Back to countries"})})]})]})]})}function Be(){return t.jsx(Le,{title:t.jsx(x,{message:"Zooming in"}),body:t.jsx(x,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const _="gap-12 md:gap-24 mb-12 md:mb-24",E=`flex flex-col md:flex-row md:items-center overflow-x-auto ${_}`;function $e({report:e,isLoading:a}){const s=e==null?void 0:e.pageViews.total;return t.jsxs(c.Fragment,{children:[t.jsxs("div",{className:E,children:[t.jsx(Ie,{isLoading:a,className:"flex-auto",data:e==null?void 0:e.pageViews,title:t.jsx(x,{message:"Pageviews"}),description:s?t.jsx(x,{message:":count total views",values:{count:t.jsx(w,{value:s})}}):null}),t.jsx(Ae,{isLoading:a,data:e==null?void 0:e.devices,title:t.jsx(x,{message:"Top devices"})})]}),t.jsxs("div",{className:E,children:[t.jsx(Fe,{isLoading:a,data:e==null?void 0:e.browsers,className:"flex-auto md:w-1/3",direction:"horizontal",individualBarColors:!0,hideLegend:!0,title:t.jsx(x,{message:"Top browsers"})}),t.jsx(Me,{isLoading:a,className:"flex-auto",data:e==null?void 0:e.locations,title:t.jsx(x,{message:"Top locations"})})]})]})}function He({report:e,isLoading:a}){return t.jsx("div",{className:`flex h-[97px] flex-shrink-0 items-center overflow-x-auto ${_}`,children:e==null?void 0:e.map(s=>t.jsx(Ge,{datum:s,isLoading:a},s.name))})}function Ge({datum:e,isLoading:a=!1}){let s;if(c.isValidElement(e.icon))s=c.cloneElement(e.icon,{size:"lg"});else{const n=le(e.icon);s=t.jsx(n,{size:"lg"})}return t.jsxs("div",{className:"rounded-panel flex h-full flex-auto items-center gap-18 whitespace-nowrap border p-20",children:[t.jsx("div",{className:"flex-shrink-0 rounded-lg bg-primary-light/20 p-10 text-primary",children:s}),t.jsxs("div",{className:"flex-auto",children:[t.jsx("div",{className:"flex items-center justify-between gap-20",children:t.jsx("div",{className:"text-lg font-bold text-main",children:t.jsx(ce,{initial:!1,mode:"wait",children:a?t.jsx(R.div,{...A,children:t.jsx(me,{className:"min-w-24"})},"skeleton"):t.jsx(R.div,{...A,children:t.jsx(_e,{datum:e})},"value")})})}),t.jsxs("div",{className:"flex items-center justify-between gap-20",children:[t.jsx("h2",{className:"text-sm text-muted",children:e.name}),(e.percentageChange!=null||e.previousValue!=null)&&t.jsx("div",{className:"flex items-center gap-10",children:t.jsx(Ke,{datum:e})})]})]})]},e.name)}function _e({datum:e}){switch(e.type){case"fileSize":return t.jsx(ye,{bytes:e.currentValue});case"percentage":return t.jsx(w,{value:e.currentValue,style:"percent",maximumFractionDigits:1});default:return t.jsx(w,{value:e.currentValue})}}function Ke({datum:e}){const a=Oe(e);let s;return a>0?s=t.jsx(xe,{size:"md",className:"text-positive"}):a===0?s=t.jsx(ge,{className:"text-muted"}):s=t.jsx(fe,{className:"text-danger"}),t.jsxs(c.Fragment,{children:[s,t.jsxs("div",{className:"text-sm font-semibold text-muted",children:[a,"%"]})]})}function Oe({percentageChange:e,previousValue:a,currentValue:s}){return e!=null||a==null||s==null?e??0:a===0?100:Math.round((s-a)/a*100)}const qe={month:"short",day:"2-digit"};function Ue({value:e,onChange:a,disabled:s,compactOnMobile:n=!0,enableCompare:r=!1,granularity:i="minute"}){const l=$();return t.jsxs(M,{type:"popover",onClose:o=>{o&&a(o)},children:[t.jsx(B,{variant:"outline",color:"chip",endIcon:t.jsx(pe,{}),disabled:s,children:t.jsx(je,{start:e.start,end:e.end,options:l&&n?qe:de.short})}),t.jsx(We,{value:e,enableCompare:r,granularity:i})]})}function We({value:e,enableCompare:a,granularity:s}){const n=$(),r=F({granularity:s,defaultValue:{start:e.start,end:e.end,preset:e.preset},closeDialogOnSelection:!1}),i=!!e.compareStart&&!!e.compareEnd,l=F({granularity:s,defaultValue:i?{start:e.compareStart,end:e.compareEnd,preset:e.comparePreset}:be[0].getRangeValue(r.selectedValue)});return t.jsx(ve,{state:r,compareState:a?l:void 0,compareVisibleDefault:i,showInlineDatePickerField:!n})}function tt(){const[e,a]=c.useState(()=>we[2].getRangeValue()),{isLoading:s,data:n}=Ne({dateRange:e}),r=t.jsx(x,{message:"Visitors report"});return t.jsxs("div",{className:"min-h-full gap-12 overflow-x-hidden p-12 md:gap-24 md:p-24",children:[t.jsxs("div",{className:"mb-24 items-center justify-between gap-24 md:flex",children:[t.jsx(ue,{children:r}),t.jsx("h1",{className:"mb-24 text-3xl font-light md:mb-0",children:r}),t.jsx(Ue,{value:e,onChange:a})]}),t.jsx(He,{report:n==null?void 0:n.headerReport}),t.jsx($e,{report:n==null?void 0:n.visitorsReport,isLoading:s})]})}export{tt as default};
//# sourceMappingURL=admin-report-page-bd2ce8c5.js.map
